<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kit de Bem-Estar e Alegria ‚Äî Interativo</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>

  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&family=Pacifico&family=Cinzel:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root{ --bg-body:#FDF9F3; --bg-container:#FFFFFF; --bg-panel:#F0F8FF; --accent:#FFC0CB; --muted:#9AAFC0; --primary:#87CEEB; --whatsapp:#128C7E; }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:'Quicksand',sans-serif;background:var(--bg-body);display:flex;flex-direction:column;align-items:center;min-height:100vh}

    .game-wrapper{width:100%;display:flex;justify-content:center;padding:24px;flex:1}
    .container{width:100%;max-width:1100px;background:var(--bg-container);border-radius:14px;padding:20px;border:1px solid rgba(163,216,244,0.6);box-shadow:0 6px 18px rgba(16,24,40,0.08)}

    header h1{font-family:'Pacifico',cursive;color:var(--accent);text-align:center;margin:0;padding-bottom:10px;font-size:2.3rem}
    .mission-section{display:flex;justify-content:center;margin-bottom:14px}
    .editable-title{padding:4px 8px;border-radius:8px;border:1px dashed rgba(163,216,244,0.7);min-width:140px}

    .main-content{display:flex;gap:20px;flex-wrap:wrap}
    .left-column{flex:2;min-width:300px}
    .right-column{flex:1;min-width:260px;background:var(--bg-panel);border-radius:10px;padding:12px;border:1px solid rgba(163,216,244,0.6)}

    .panel-title{font-weight:700;margin:0 0 10px 0}

    .item-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(88px,1fr));gap:12px}
    .slot{height:88px;border-radius:10px;border:2px dashed rgba(163,216,244,0.8);background:linear-gradient(180deg,#fff,#fbfdff);display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden;transition:transform .18s ease, box-shadow .18s ease}
    .slot:hover{transform:translateY(-6px);box-shadow:0 10px 20px rgba(16,24,40,0.06)}
    .slot.filled{border-style:solid}
    @keyframes pulse-soft{0%{box-shadow:0 0 0 0 rgba(135,206,235,0.06)}50%{box-shadow:0 0 0 8px rgba(135,206,235,0.02)}100%{box-shadow:0 0 0 0 rgba(135,206,235,0.00)}}
    .slot:empty{animation:pulse-soft 3s infinite}

    .item{display:flex;align-items:center;gap:8px;padding:6px 8px;border-radius:8px;background:rgba(255,255,255,0.95);cursor:grab;user-select:none;box-shadow:0 2px 8px rgba(16,24,40,0.06);max-width:100%}
    .item:active{cursor:grabbing}
    .item .icon{font-size:1.5rem;line-height:1}
    .item p{margin:0;font-weight:600;font-size:0.9rem;color:#333;max-width:100%;word-break:break-word;overflow-wrap:break-word;text-align:center}

    /* inside slot, the text should wrap and center nicely */
    .slot .item{flex-direction:column;justify-content:center;align-items:center;height:100%;padding:6px}
    .slot .item p{font-size:0.95rem;padding:2px 6px}

    .slot .controls{position:absolute;bottom:6px;right:6px;display:flex;gap:6px;opacity:0;pointer-events:none;transition:opacity .18s ease, transform .18s ease;transform:translateY(6px) scale(.95);z-index:5}
    .slot:hover .controls, .slot.show-controls .controls{opacity:1;pointer-events:auto;transform:translateY(0) scale(1)}
    .icon-btn{background:rgba(255,255,255,0.92);border:1px solid rgba(163,216,244,0.7);border-radius:6px;padding:4px 6px;cursor:pointer;font-size:0.85rem;line-height:1}
    .icon-btn[title="Editar"]{padding:3px 5px;font-size:0.78rem} 
    .icon-btn{background:rgba(255,255,255,0.85);border:1px solid rgba(163,216,244,0.6);border-radius:6px;padding:4px;cursor:pointer;font-size:0.9rem}

    .pop-in{animation:pop .28s cubic-bezier(.2,.9,.3,1)}
    @keyframes pop{0%{transform:scale(.86)}60%{transform:scale(1.08)}100%{transform:scale(1)}}

    .inspiration-list{display:flex;flex-direction:column;gap:8px;max-height:420px;overflow:auto;padding-right:6px}
    .inspiration-list::-webkit-scrollbar{width:8px}
    .inspiration-list::-webkit-scrollbar-thumb{background:var(--accent);border-radius:6px}

    #emoji-picker{display:none;position:absolute;right:0;top:calc(100% + 8px);background:white;padding:8px;border-radius:10px;border:1px solid rgba(163,216,244,0.6);grid-template-columns:repeat(6,1fr);gap:6px;z-index:20}
    #emoji-picker.show{display:grid}

    .export-section{text-align:center;margin-top:18px}
    #exportBtn{background:var(--primary);color:#fff;border:none;padding:12px 18px;border-radius:10px;font-weight:700;cursor:pointer}

    .whatsapp-btn{position:fixed;right:16px;bottom:20vh;background:var(--whatsapp);color:white;padding:12px;border-radius:999px;display:flex;align-items:center;justify-content:center;z-index:50;border:2px solid #fff;box-shadow:0 8px 28px rgba(18,140,126,0.18);transition:transform .18s}

    .confetti-piece{position:absolute;width:8px;height:8px;border-radius:2px;opacity:.95;will-change:transform,opacity}

    .static-footer{margin-top:18px;background:linear-gradient(180deg,rgba(50,60,70,0.95),rgba(70,80,90,0.9));color:white;padding:14px;border-radius:10px;text-align:center;font-size:0.8rem}

    @media (max-width:900px){.main-content{gap:14px}.left-column{min-width:100%}.right-column{min-width:100%}}
    @media (max-width:420px){header h1{font-size:1.6rem}.slot{height:78px}}
  </style>
</head>
<body>

  <a href="https://wa.link/ydbdpl" target="_blank" class="whatsapp-btn" aria-label="Precisa de ajuda?">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.9 8.9 0 0 1-4.1 3.8l-.3.1-.4.1c-.8.2-1.6.3-2.5.3A9 9 0 1 1 21 11.5z"></path><path d="M17 14c-.4 0-1.3-.6-1.6-.8"></path></svg>
  </a>

  <div class="game-wrapper">
    <div class="container" id="captureArea">
      <header>
        <h1>Meu Kit de Bem-Estar e Alegria</h1>
      </header>

      <section class="mission-section">
        <h3>Meu Plano do Dia: <span class="editable-title" contenteditable="true" aria-label="Editar plano">O que me far√° sorrir hoje?</span></h3>
      </section>

      <div class="main-content">
        <div class="left-column">

          <div class="happiness-tools" aria-hidden="false">
            <h2 class="panel-title">Minhas Ferramentas da Felicidade</h2>
            <div class="item-grid" id="slots">
              <div class="slot" data-slot="1"></div>
              <div class="slot" data-slot="2"></div>
              <div class="slot" data-slot="3"></div>
              <div class="slot" data-slot="4"></div>
              <div class="slot" data-slot="5"></div>
              <div class="slot" data-slot="6"></div>
              <div class="slot" data-slot="7"></div>
              <div class="slot" data-slot="8"></div>
              <div class="slot" data-slot="9"></div>
              <div class="slot" data-slot="10"></div>
              <div class="slot" data-slot="11"></div>
              <div class="slot" data-slot="12"></div>
            </div>
          </div>

          <div class="custom-item-creator" style="margin-top:12px">
            <h3 class="panel-title">Crie uma Nova Inspira√ß√£o</h3>
            <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px;position:relative">
              <input id="custom-name" placeholder="Nome da estrat√©gia..." style="flex:1;padding:10px;border-radius:8px;border:1px solid rgba(163,216,244,0.6)" />
              <input id="custom-icon" placeholder="√çcone" style="width:76px;padding:10px;border-radius:8px;border:1px solid rgba(163,216,244,0.6);text-align:center" />
              <button id="emoji-toggle-button" title="Escolher emoji" style="border-radius:8px;padding:10px;border:1px solid rgba(163,216,244,0.6);background:white">‚ú®</button>
              <div id="emoji-picker" aria-hidden="true">
                <button class="emoji">üòä</button><button class="emoji">üíñ</button><button class="emoji">‚ú®</button><button class="emoji">üåü</button><button class="emoji">‚òÄÔ∏è</button><button class="emoji">üåø</button>
                <button class="emoji">üé®</button><button class="emoji">üé∂</button><button class="emoji">üßò‚Äç‚ôÄÔ∏è</button><button class="emoji">üèÉ‚Äç‚ôÄÔ∏è</button><button class="emoji">üìö</button><button class="emoji">üí°</button>
              </div>
            </div>
            <button id="addItemBtn" style="margin-top:8px;width:100%;padding:10px;border-radius:8px;background:var(--primary);color:#fff;border:none">Adicionar Inspira√ß√£o</button>
          </div>

        </div>

        <div class="right-column">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
            <h3 class="panel-title">Inspira√ß√µes e Boas Energias</h3>
            <button id="clearListBtn" title="Limpar lista" style="background:none;border:none;color:var(--muted);cursor:pointer">Limpar</button>
          </div>

          <div class="inspiration-list" id="itemList">
            <div class="item" tabindex="0"><span class="icon">üé∂</span><p>M√∫sica / Playlist</p><button class="icon-btn remove">√ó</button></div>
            <div class="item" tabindex="0"><span class="icon">üíñ</span><p>Conversar com Amigo</p><button class="icon-btn remove">√ó</button></div>
            <div class="item" tabindex="0"><span class="icon">üßò‚Äç‚ôÄÔ∏è</span><p>Medita√ß√£o / Relaxar</p><button class="icon-btn remove">√ó</button></div>
            <div class="item" tabindex="0"><span class="icon">‚òÅÔ∏è</span><p>Respirar Fundo</p><button class="icon-btn remove">√ó</button></div>
            <div class="item" tabindex="0"><span class="icon">‚ú®</span><p>Anotar Gratid√µes</p><button class="icon-btn remove">√ó</button></div>
            <div class="item" tabindex="0"><span class="icon">üêæ</span><p>Carinho no Pet</p><button class="icon-btn remove">√ó</button></div>
            <div class="item" tabindex="0"><span class="icon">üé®</span><p>Praticar um Hobbie</p><button class="icon-btn remove">√ó</button></div>
            <div class="item" tabindex="0"><span class="icon">üçì</span><p>Lanche Saboroso</p><button class="icon-btn remove">√ó</button></div>
            <div class="item" tabindex="0"><span class="icon">üö∂‚Äç‚ôÄÔ∏è</span><p>Passeio ao Ar Livre</p><button class="icon-btn remove">√ó</button></div>
            <div class="item" tabindex="0"><span class="icon">üåü</span><p>Visualizar Sonhos</p><button class="icon-btn remove">√ó</button></div>
          </div>

        </div>
      </div>

      <div class="export-section">
        <button id="exportBtn">Salvar Meu Quadro da Alegria</button>
      </div>

    </div>
  </div>

  <footer class="static-footer font-cinzel">
    <div style="opacity:.95">Desenvolvido por <a href="https://www.instagram.com/gabrielopsicologo" target="_blank" style="color:var(--primary);text-decoration:none">@gabrielopsicologo</a> ‚Ä¢ CRP 06/215890 ‚Ä¢ &copy; 2025</div>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', ()=>{
      lucide && lucide.createIcons && lucide.createIcons();

      const slots = Array.from(document.querySelectorAll('.slot'));
      const itemList = document.getElementById('itemList');
      const addItemBtn = document.getElementById('addItemBtn');
      const customName = document.getElementById('custom-name');
      const customIcon = document.getElementById('custom-icon');
      const emojiToggle = document.getElementById('emoji-toggle-button');
      const emojiPicker = document.getElementById('emoji-picker');
      const clearListBtn = document.getElementById('clearListBtn');
      const exportBtn = document.getElementById('exportBtn');
      const captureArea = document.getElementById('captureArea');

      // make list items draggable and keyboard accessible
      function makeDraggable(el){
        el.setAttribute('draggable','true');
        el.addEventListener('dragstart', e=>{
          const icon = el.querySelector('.icon')?.textContent || '';
          const type = el.querySelector('p')?.textContent || '';
          e.dataTransfer.setData('text/plain',JSON.stringify({icon,type}));
        });

        // keyboard: Enter/Space will place into first empty slot
        el.addEventListener('keydown', e=>{
          if(e.key === ' '|| e.key === 'Enter'){
            e.preventDefault(); const icon = el.querySelector('.icon')?.textContent || ''; const name = el.querySelector('p')?.textContent || ''; placeFirstEmpty(icon,name);
          }
        });
      }

      // initial make draggable and add remove button handlers
      Array.from(document.querySelectorAll('#itemList .item')).forEach(item=>{
        makeDraggable(item);
        const removeBtn = item.querySelector('.remove');
        if(removeBtn){ removeBtn.addEventListener('click', (ev)=>{ ev.stopPropagation(); if(confirm('Remover esta inspira√ß√£o?')) item.remove(); }); }
      });

      // drop handling
      slots.forEach(slot=>{
        slot.addEventListener('dragover', e=>{ e.preventDefault(); slot.classList.add('drag-over') });
        slot.addEventListener('dragleave', ()=>slot.classList.remove('drag-over'));
        slot.addEventListener('drop', e=>{
          e.preventDefault(); slot.classList.remove('drag-over');
          if(slot.querySelector('.item')) return; // j√° ocupado
          try{ const data = JSON.parse(e.dataTransfer.getData('text/plain')); placeInSlot(slot, data.icon, data.type); }catch(err){/*ignore*/}
        });

        // click to remove item from slot (mobile friendly)
        slot.addEventListener('click', e=>{
          const child = slot.querySelector('.item');
          if(child){ if(confirm('Remover este item da caixa?')){ slot.innerHTML=''; slot.classList.remove('filled'); } }
        });
      });

      // helper: place item into slot with editable name and small controls
      function placeInSlot(slot, icon, name){
        const node = document.createElement('div'); node.className='item pop-in';
        node.innerHTML = `<span class="icon">${icon}</span><p contenteditable="true" spellcheck="false">${name}</p>`;
        // controls (edit focus + remove)
        const controls = document.createElement('div'); controls.className='controls';
        const editBtn = document.createElement('button'); editBtn.className='icon-btn'; editBtn.title='Editar'; editBtn.innerHTML='‚úé';
        const removeBtn = document.createElement('button'); removeBtn.className='icon-btn'; removeBtn.title='Remover'; removeBtn.innerHTML='√ó';
        controls.appendChild(editBtn); controls.appendChild(removeBtn);
        slot.appendChild(node); slot.appendChild(controls); slot.classList.add('filled');

        // focus edit when clicking edit
        editBtn.addEventListener('click', (ev)=>{ ev.stopPropagation(); const p = node.querySelector('p'); p.focus(); selectElementContents(p); });
        removeBtn.addEventListener('click', (ev)=>{ ev.stopPropagation(); if(confirm('Remover este item da caixa?')){ slot.innerHTML=''; slot.classList.remove('filled'); } });

        // ensure p wraps and remains centered; handle enter key to blur
        const p = node.querySelector('p');
        p.addEventListener('keydown', e=>{ if(e.key === 'Enter'){ e.preventDefault(); p.blur(); } });
        // show controls while editing (helps on mobile when hover isn't available)
        p.addEventListener('focus', ()=>{ slot.classList.add('show-controls'); });
        p.addEventListener('blur', ()=>{ setTimeout(()=> slot.classList.remove('show-controls'), 120); });
      }

      // utility to select text (for edit delight)
      function selectElementContents(el){ const range = document.createRange(); range.selectNodeContents(el); const sel = window.getSelection(); sel.removeAllRanges(); sel.addRange(range); }

      function placeFirstEmpty(icon,name){ const first = slots.find(s=>!s.querySelector('.item')); if(first) placeInSlot(first,icon,name); }

      // clicking items in the list places into first empty slot (mobile friendly)
      itemList.addEventListener('click', e=>{
        const item = e.target.closest('.item'); if(!item) return;
        // if clicked the remove button, ignore (handled earlier)
        if(e.target.classList.contains('remove')) return;
        const icon = item.querySelector('.icon')?.textContent || '';
        const name = item.querySelector('p')?.textContent || '';
        placeFirstEmpty(icon,name);
      });

      // add custom item
      addItemBtn.addEventListener('click', ()=>{
        const name = customName.value.trim(); const icon = customIcon.value.trim();
        if(!name || !icon){ alert('Preencha nome e √≠cone (ex: emoji)'); return; }
        if(Array.from(icon).length>2){ alert('Use 1-2 caracteres para o √≠cone.'); return; }
        const el = document.createElement('div'); el.className='item'; el.tabIndex=0; el.innerHTML=`<span class="icon">${icon}</span><p>${name}</p><button class="icon-btn remove">√ó</button>`;
        itemList.prepend(el); makeDraggable(el);
        const removeBtn = el.querySelector('.remove'); removeBtn.addEventListener('click', (ev)=>{ ev.stopPropagation(); if(confirm('Remover esta inspira√ß√£o?')) el.remove(); });
        customName.value=''; customIcon.value='';
      });

      // emoji picker wiring (fixed): delegate to buttons with class 'emoji'
      emojiToggle.addEventListener('click', e=>{ e.stopPropagation(); emojiPicker.classList.toggle('show'); emojiPicker.setAttribute('aria-hidden', String(!emojiPicker.classList.contains('show'))); });
      emojiPicker.addEventListener('click', e=>{ const btn = e.target.closest('.emoji'); if(!btn) return; customIcon.value = btn.textContent; emojiPicker.classList.remove('show'); emojiPicker.setAttribute('aria-hidden','true'); });
      document.addEventListener('click', ()=>{ emojiPicker.classList.remove('show'); emojiPicker.setAttribute('aria-hidden','true'); });

      // clear list
      clearListBtn.addEventListener('click', ()=>{ if(confirm('Limpar todas as inspira√ß√µes?')) itemList.innerHTML=''; });

      // lightweight confetti
      function fireConfetti(count){ const colors=['#FFC0CB','#87CEEB','#FFD700','#7FFFD4','#FFB347','#B19CD9']; for(let i=0;i<count;i++){ const d=document.createElement('div'); d.className='confetti-piece'; d.style.background=colors[Math.floor(Math.random()*colors.length)]; d.style.left = (50 + (Math.random()-0.5)*60) + '%'; d.style.top = (40 + (Math.random()-0.5)*8) + '%'; const rot=Math.random()*360; const dx=(Math.random()-0.5)*600; const dy=-(200+Math.random()*600); captureArea.appendChild(d); const duration=900+Math.random()*800; const start=performance.now(); (function frame(now){ const t=(now-start)/duration; if(t>1){ d.remove(); return; } d.style.transform = `translate3d(${dx*t}px, ${dy*t + (Math.sin(t*10)*12)}px,0) rotate(${rot + t*720}deg)`; d.style.opacity = String(1 - t); requestAnimationFrame(frame); })(start+0); } }

      // export behavior (hide floats)
      exportBtn.addEventListener('click', ()=>{
        const fixed = document.querySelectorAll('.whatsapp-btn, .static-footer'); exportBtn.style.display='none'; fixed.forEach(f=>f.style.display='none');
        setTimeout(()=>{ html2canvas(captureArea,{useCORS:true,scale:2,backgroundColor:'#FFFFFF'}).then(canvas=>{ const link=document.createElement('a'); link.download='meu-kit-de-bem-estar.png'; link.href = canvas.toDataURL('image/png'); link.click(); exportBtn.style.display='inline-block'; fixed.forEach(f=>f.style.display=''); }).catch(err=>{ console.error(err); exportBtn.style.display='inline-block'; fixed.forEach(f=>f.style.display=''); }); },180);
      });

      // Accessibility: allow pressing Enter/Space on list items (handled by makeDraggable)
    });
  </script>
</body>
</html>
