<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logbook da Grande Rota: Defesa do Sunny ‚Äî Interativo</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Rye&family=Special+Elite&display=swap');

        :root { --bg-body:#FDF5E6; --bg-container:#FAF0E0; --bg-panel:#FDF5E6; --bg-input:#FFFFFF; --border-color:#8B4513; --accent-color:#D90429; --text-dark:#3D2B1F; --text-light:#5A4A3A; --hover-color:#F5E5C0; --button-primary:#3D5A80; --button-primary-hover:#5A7A9E; --button-secondary:#E0A96D; --button-secondary-hover:#C8945D; }

        *{box-sizing:border-box}
        html,body{height:100%}
        body{color:var(--text-dark);font-family:'Special Elite',monospace;display:flex;justify-content:center;align-items:flex-start;padding:20px;min-height:100vh;background-color:var(--bg-body);background-image:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAIQSURBVHhe7dJBTsNADAXQgwLbDAf0IqS6+xQ8YI+lEaNhHiqQYwDBIFxMcs7J7YxnfvP95PzcgcwAAAAAAFiUl/l8vj17AS6Xy6e7bweYXq9/de/rA8y3g4E3IwszQkYWY4SMLEXImJmFkDEziyFjZlZDxo7sZIwsq8hYmVkLmTuzmjJ2ZkNGtixlxMzshYwZmZUys2EZyMaEdWQsZlZExsLsi4wtWYQYs64jY2tWRcbS7IeMbdlFGGOVZWQY5WoyDHKNNMMcW0cyxFYRzJHFNHMcY0cwx5rJzLFVBDMss5IyLGe1cmY5Q5kZlknJmGWWsWYEZ5FyZ1lKmRlWScqcpTVlpllGGWuSs2ZZJjVrlrGmBWOWt2ZpNjVnlrEmBWeSMyVZJjVnkrEmBWOSM0gZkzRLGTOSM0cZM5JzRhkzknNGGTOcM0sZM5tTRhkzmlNGGTOaU0YZE5pTRhkTmjdGGROSN0YZI5t7Rhkjm/dGGSObe0YZE5t7RhkTm/dGGROWd0YZI5f3Rhkjl/dGGROWd0YZE5d3RhkTl/dGGROXd0YZG5b3Rhkbl/dGGVuXd0YZW5b3Rhkbl/dGGdtkN2XMtu2NDOW2bW+kMMi27o0Mhd2NDGVOd2+kMGg3M5QZ3b2RQdHciFFmdyMKYXY3IhRpdjMhFGt2MyEUa3YzIZRrdjMhFGt2MyEUa3YzIZRrdjMhFGt2MyEUa3YzIVRrNjMhFGF2YwIAAAAAAD4Tz9sYFk8/iN0TAAAAABJRU5ErkJggg==');background-attachment:fixed}

        .container{width:100%;max-width:1120px;border:3px solid var(--border-color);background:var(--bg-container);padding:22px;box-shadow:0 12px 30px rgba(0,0,0,0.25);border-radius:10px; display: flex; flex-direction: column;} /* Adicionado flex column para garantir ordem */
        
        header h1{font-family:'Rye',serif;text-align:center;color:var(--text-dark);font-size:3rem;margin:0 0 10px 0;border-bottom:3px dashed var(--border-color);padding-bottom:12px}
        .mission-section{display:flex;justify-content:center;margin-bottom:18px}
        .editable-title{padding:4px 8px;border-bottom:2px dotted var(--border-color);border-radius:6px}

        .main-content{display:flex;gap:24px;flex-wrap:wrap}
        .left-column{flex:2;min-width:300px}
        .right-column{flex:1;min-width:280px;background:var(--bg-panel);border:2px solid var(--border-color);border-radius:8px;padding:12px}

        .panel-title{font-weight:bold;margin:0 0 8px 0;font-size:1.6rem}

        .item-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(96px,1fr));gap:12px}
        .slot{height:96px;border-radius:10px;border:2px dashed var(--border-color);background:rgba(0,0,0,0.03);display:flex;flex-direction:column;justify-content:center;align-items:center;position:relative;overflow:hidden;transition:transform .18s,box-shadow .18s}
        .slot:hover{transform:translateY(-6px);box-shadow:0 10px 20px rgba(0,0,0,0.12)}
        .slot.filled{border-style:solid}

        /* controls hidden by default, appear on hover or while editing */
        .slot .controls{position:absolute;bottom:6px;right:6px;display:flex;gap:6px;opacity:0;pointer-events:none;transition:opacity .18s ease, transform .18s ease;transform:translateY(6px) scale(.95);z-index:5}
        .slot:hover .controls, .slot.show-controls .controls{opacity:1;pointer-events:auto;transform:translateY(0) scale(1)}
        .icon-btn{background:rgba(255,255,255,0.92);border:1px solid rgba(139,69,19,0.6);border-radius:6px;padding:4px 6px;cursor:pointer;font-size:0.85rem;line-height:1}
        .icon-btn[title="Editar"]{padding:3px 5px;font-size:0.78rem}

        .item{display:flex;align-items:center;gap:8px;padding:6px 8px;border-radius:8px;background:var(--bg-input);cursor:grab;user-select:none;box-shadow:0 2px 8px rgba(0,0,0,0.08)}
        .item .icon{font-size:1.6rem}
        .item p{margin:0;font-weight:700;font-size:0.95rem;color:var(--text-dark);text-align:center}

        .slot .item{flex-direction:column;justify-content:center;align-items:center;height:100%;padding:6px}
        .slot .item p{font-size:0.95rem;padding:2px 6px}

        .inspiration-list{display:flex;flex-direction:column;gap:8px;max-height:460px;overflow:auto;padding-right:6px}
        .inspiration-list::-webkit-scrollbar{width:8px}
        .inspiration-list::-webkit-scrollbar-thumb{background:var(--accent-color);border-radius:6px}

        #emoji-picker{display:none;position:absolute;right:0;top:calc(100% + 8px);background:white;padding:8px;border-radius:8px;border:2px solid var(--border-color);grid-template-columns:repeat(6,1fr);gap:6px;z-index:20}
        #emoji-picker.show{display:grid}
        .emoji{background:transparent;border:none;font-size:1.2rem;cursor:pointer}

        .export-section{text-align:center;margin-top:24px;margin-bottom:16px;}
        #exportBtn{background:var(--button-secondary);color:var(--text-dark);border:none;padding:12px 20px;border-radius:10px;font-family:'Rye',serif;font-size:1.1rem;cursor:pointer; transition: transform 0.2s;}
        #exportBtn:hover{transform: scale(1.02); background: var(--button-secondary-hover);}

        /* Footer Minimalista */
        .minimal-footer {
            margin-top: auto; /* Empurra para o fundo se houver espa√ßo */
            padding-top: 1.5rem;
            border-top: 2px solid rgba(139,69,19, 0.3);
            text-align: center;
            color: var(--text-dark);
            font-family: 'Special Elite', monospace;
        }
        .footer-logo {
            height: 40px;
            opacity: 0.9;
            margin-bottom: 8px;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.1));
            transition: transform 0.3s;
        }
        .footer-logo:hover { transform: scale(1.1) rotate(-3deg); }
        .footer-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
            font-size: 0.85rem;
        }
        .footer-link {
            color: var(--button-primary);
            text-decoration: none;
            font-weight: bold;
        }
        .footer-copyright {
            font-size: 0.7rem;
            opacity: 0.7;
            margin-top: 6px;
        }

        @media (max-width:520px){.item-grid{grid-template-columns:repeat(4,1fr)}.slot{height:84px}}
    </style>
</head>
<body>

    <a href="https://wa.me/message/WV34TWMSKTEEL1" target="_blank" title="Precisa de Ajuda?" class="whatsapp-btn" style="position:fixed;right:16px;bottom:18px;background:#25D366;color:#fff;padding:12px;border-radius:999px;z-index:50;border:2px solid #fff;box-shadow:0 8px 28px rgba(0,0,0,0.12)">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.9 8.9 0 0 1-4.1 3.8l-.3.1-.4.1c-.8.2-1.6.3-2.5.3A9 9 0 1 1 21 11.5z"></path></svg>
    </a>

    <div class="container" id="captureArea">
        <header><h1>Logbook da Grande Rota</h1></header>

        <section class="mission-section">
            <h3>Rota do Dia (Amea√ßa): <span class="editable-title" contenteditable="true">O que vamos enfrentar hoje?</span></h3>
        </section>

        <div class="main-content">
            <div class="left-column">
                <div class="happiness-tools">
                    <h2 class="panel-title">Arsenal da Tripula√ß√£o (Slots)</h2>
                    <div class="item-grid" id="slots">
                        <div class="slot" data-slot="1"></div><div class="slot" data-slot="2"></div><div class="slot" data-slot="3"></div><div class="slot" data-slot="4"></div>
                        <div class="slot" data-slot="5"></div><div class="slot" data-slot="6"></div><div class="slot" data-slot="7"></div><div class="slot" data-slot="8"></div>
                        <div class="slot" data-slot="9"></div><div class="slot" data-slot="10"></div><div class="slot" data-slot="11"></div><div class="slot" data-slot="12"></div>
                    </div>
                </div>

                <div class="custom-item-creator" style="margin-top:12px">
                    <h3 class="panel-title">Adicionar Habilidade ao Log</h3>
                    <input type="text" id="custom-name" placeholder="Nome da Habilidade...">
                    <div class="input-group" style="display:flex;gap:8px;align-items:center;position:relative;margin-top:8px">
                        <input type="text" id="custom-icon" placeholder="S√≠mbolo..." style="width:76px;padding:8px;border-radius:6px;border:2px solid var(--border-color);text-align:center;background:var(--bg-input)">
                        <button id="emoji-toggle-button" title="Escolher s√≠mbolo" style="padding:8px;border-radius:6px;border:2px solid var(--border-color);background:var(--bg-input);cursor:pointer">üè¥‚Äç‚ò†Ô∏è</button>
                        <div id="emoji-picker" aria-hidden="true">
                            <button class="emoji">üè¥‚Äç‚ò†Ô∏è</button><button class="emoji">üçñ</button><button class="emoji">‚öîÔ∏è</button><button class="emoji">üó∫Ô∏è</button><button class="emoji">‚öì</button><button class="emoji">üí∞</button>
                            <button class="emoji">üß≠</button><button class="emoji">üåä</button><button class="emoji">‚õµ</button><button class="emoji">üíÄ</button><button class="emoji">üëë</button><button class="emoji">üî•</button>
                        </div>
                    </div>
                    <button id="addItemBtn" style="margin-top:10px;padding:10px;border-radius:8px;background:var(--button-primary);color:#fff;border:none;cursor:pointer">Adicionar Habilidade</button>
                </div>
            </div>

            <div class="right-column">
                <div class="title-wrapper" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
                    <h3 class="panel-title">Tesouros de Habilidades</h3>
                    <button id="clearListBtn" title="Jogar tesouros ao mar (Limpar lista)" style="background:none;border:none;cursor:pointer;color:var(--text-light)"><i data-lucide="trash-2"></i></button>
                </div>
                <div class="inspiration-list" id="itemList">
                    <div class="item" draggable="true"><span class="remove-item-list" title="Remover">&times;</span><span class="icon">üé∂</span><p>M√∫sica / Playlist</p></div>
                    <div class="item" draggable="true"><span class="remove-item-list" title="Remover">&times;</span><span class="icon">üíñ</span><p>Conversar com Amigo</p></div>
                    <div class="item" draggable="true"><span class="remove-item-list" title="Remover">&times;</span><span class="icon">üßò‚Äç‚ôÄÔ∏è</span><p>Medita√ß√£o / Relaxar</p></div>
                    <div class="item" draggable="true"><span class="remove-item-list" title="Remover">&times;</span><span class="icon">‚òÅÔ∏è</span><p>Respirar Fundo</p></div>
                    <div class="item" draggable="true"><span class="remove-item-list" title="Remover">&times;</span><span class="icon">‚ú®</span><p>Anotar Gratid√µes</p></div>
                    <div class="item" draggable="true"><span class="remove-item-list" title="Remover">&times;</span><span class="icon">üêæ</span><p>Carinho no Pet</p></div>
                </div>
            </div>
        </div>

        <div class="export-section">
            <button id="exportBtn">Salvar P√°gina do Logbook</button>
        </div>

        <footer class="minimal-footer">
            <a href="https://www.instagram.com/gabrielopsicologo" target="_blank">
                <img src="https://cdn.jsdelivr.net/gh/gabriel20402/Jogos-terapeuticos@main/Logo_branca.png" alt="Logo Gabriel Psic√≥logo" class="footer-logo" style="filter: invert(1) brightness(0.2);"> 
                </a>
            <div class="footer-info">
                <span>Desenvolvido por <a href="https://www.instagram.com/gabrielopsicologo" target="_blank" class="footer-link">@gabrielopsicologo</a></span>
                <span>Gabriel Vinicius dos Santos Fernandes Vasconcelos - CRP 06/215890</span>
            </div>
            <div class="footer-copyright">
                &copy; 2025 Todos os direitos reservados.
            </div>
        </footer>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            lucide && lucide.createIcons && lucide.createIcons();

            const slots = Array.from(document.querySelectorAll('.slot'));
            const itemList = document.getElementById('itemList');
            const customNameInput = document.getElementById('custom-name');
            const customIconInput = document.getElementById('custom-icon');
            const addItemBtn = document.getElementById('addItemBtn');
            const emojiToggleButton = document.getElementById('emoji-toggle-button');
            const emojiPicker = document.getElementById('emoji-picker');
            const clearListBtn = document.getElementById('clearListBtn');
            const exportBtn = document.getElementById('exportBtn');
            const captureArea = document.getElementById('captureArea');

            function makeDraggable(el){
                el.setAttribute('draggable','true');
                el.addEventListener('dragstart', e=>{
                    const icon = el.querySelector('.icon')?.textContent || '';
                    const type = el.querySelector('p')?.textContent || '';
                    e.dataTransfer.setData('text/plain', JSON.stringify({icon,type}));
                });
                el.addEventListener('keydown', e=>{
                    if(e.key === ' ' || e.key === 'Enter'){
                        e.preventDefault(); const icon = el.querySelector('.icon')?.textContent || ''; const name = el.querySelector('p')?.textContent || ''; placeFirstEmpty(icon,name);
                    }
                });
            }

            Array.from(document.querySelectorAll('#itemList .item')).forEach(item=>{
                makeDraggable(item);
                const removeBtn = item.querySelector('.remove-item-list');
                if(removeBtn){ removeBtn.addEventListener('click', ev=>{ ev.stopPropagation(); if(confirm('Remover esta habilidade?')) item.remove(); }); }
            });

            // list click (mobile) places into first empty slot
            itemList.addEventListener('click', e=>{
                const it = e.target.closest('.item'); if(!it) return; if(e.target.classList.contains('remove-item-list')) return; const icon = it.querySelector('.icon')?.textContent||''; const name = it.querySelector('p')?.textContent||''; placeFirstEmpty(icon,name);
            });

            // drop handlers
            slots.forEach(slot=>{
                slot.addEventListener('dragover', e=>{ e.preventDefault(); slot.classList.add('drag-over'); });
                slot.addEventListener('dragleave', ()=>slot.classList.remove('drag-over'));
                slot.addEventListener('drop', e=>{
                    e.preventDefault(); slot.classList.remove('drag-over'); if(slot.querySelector('.item')) return; try{ const data = JSON.parse(e.dataTransfer.getData('text/plain')); placeInSlot(slot, data.icon, data.type); }catch(err){}
                });

                slot.addEventListener('click', e=>{
                    const child = slot.querySelector('.item'); if(child && e.target.classList.contains('remove-item-slot')){ if(confirm('Deseja remover este item do seu arsenal?')){ slot.innerHTML=''; slot.classList.remove('filled'); } }
                });
            });

            function placeInSlot(slot, icon, name){
                const node = document.createElement('div'); node.className='item pop-in';
                node.innerHTML = `<span class="icon">${icon}</span><p contenteditable="true" spellcheck="false">${name}</p>`;

                // controls
                const controls = document.createElement('div'); controls.className='controls';
                const editBtn = document.createElement('button'); editBtn.className='icon-btn'; editBtn.title='Editar'; editBtn.innerHTML='‚úé';
                const removeBtn = document.createElement('button'); removeBtn.className='icon-btn'; removeBtn.title='Remover'; removeBtn.innerHTML='√ó';
                controls.appendChild(editBtn); controls.appendChild(removeBtn);

                slot.appendChild(node); slot.appendChild(controls); slot.classList.add('filled');

                // edit focus and remove
                editBtn.addEventListener('click', ev=>{ ev.stopPropagation(); const p = node.querySelector('p'); p.focus(); selectElementContents(p); });
                removeBtn.addEventListener('click', ev=>{ ev.stopPropagation(); if(confirm('Remover este item da caixa?')){ slot.innerHTML=''; slot.classList.remove('filled'); } });

                const p = node.querySelector('p');
                p.addEventListener('keydown', e=>{ if(e.key === 'Enter'){ e.preventDefault(); p.blur(); } });
                p.addEventListener('focus', ()=>{ slot.classList.add('show-controls'); });
                p.addEventListener('blur', ()=>{ setTimeout(()=> slot.classList.remove('show-controls'), 120); });

                makeDraggable(node);
            }

            function selectElementContents(el){ const range = document.createRange(); range.selectNodeContents(el); const sel = window.getSelection(); sel.removeAllRanges(); sel.addRange(range); }
            function placeFirstEmpty(icon,name){ const first = slots.find(s=>!s.querySelector('.item')); if(first) placeInSlot(first,icon,name); }

            // add custom
            addItemBtn.addEventListener('click', ()=>{
                const name = customNameInput.value.trim(); const icon = customIconInput.value.trim(); if(!name||!icon){ alert('Preencha nome e s√≠mbolo (ex: emoji)'); return; } if(Array.from(icon).length>2){ alert('Use 1-2 caracteres para o s√≠mbolo.'); return; }
                const el = document.createElement('div'); el.className='item'; el.tabIndex=0; el.innerHTML = `<span class="icon">${icon}</span><p>${name}</p><span class="remove-item-list" title="Remover">&times;</span>`;
                itemList.prepend(el); makeDraggable(el);
                const rem = el.querySelector('.remove-item-list'); rem.addEventListener('click', ev=>{ ev.stopPropagation(); if(confirm('Remover esta habilidade?')) el.remove(); });
                customNameInput.value=''; customIconInput.value='';
            });

            // emoji picker
            emojiToggleButton.addEventListener('click', e=>{ e.stopPropagation(); emojiPicker.classList.toggle('show'); emojiPicker.setAttribute('aria-hidden', String(!emojiPicker.classList.contains('show'))); });
            emojiPicker.addEventListener('click', e=>{ const btn = e.target.closest('.emoji'); if(!btn) return; customIconInput.value = btn.textContent; emojiPicker.classList.remove('show'); emojiPicker.setAttribute('aria-hidden','true'); });
            document.addEventListener('click', ()=>{ emojiPicker.classList.remove('show'); emojiPicker.setAttribute('aria-hidden','true'); });

            // clear list
            clearListBtn.addEventListener('click', ()=>{ if(confirm('Jogar todos os tesouros ao mar? (Limpar lista)')) itemList.innerHTML=''; });

            // export
            exportBtn.addEventListener('click', ()=>{
                // Oculta bot√£o de exportar e whatsapp para a foto
                const fixed = document.querySelectorAll('.whatsapp-btn'); 
                exportBtn.style.display='none'; 
                fixed.forEach(f=>f.style.visibility='hidden');

                setTimeout(()=>{ 
                    html2canvas(captureArea,{
                        useCORS:true,
                        backgroundColor: null, // Mant√©m transparente ou a cor do container
                        scale:2 // Melhor qualidade
                    }).then(canvas=>{ 
                        const link=document.createElement('a'); 
                        link.download='meu-logbook-one-piece.png'; 
                        link.href=canvas.toDataURL('image/png'); 
                        link.click(); 
                        
                        // Restaura elementos
                        exportBtn.style.display='inline-block'; 
                        fixed.forEach(f=>f.style.visibility='visible'); 
                    }).catch(err=>{ 
                        console.error(err); 
                        exportBtn.style.display='inline-block'; 
                        fixed.forEach(f=>f.style.visibility='visible'); 
                    }); 
                },180);
            });

            document.addEventListener('contextmenu', e=>e.preventDefault()); document.onkeydown = function(e){ if(e.keyCode==123 || (e.ctrlKey && e.shiftKey && (e.key==='I' || e.key==='J')) || (e.ctrlKey && e.key==='u')){ return false; } };
        });
    </script>
</body>
</html>